<?
require($_SERVER["DOCUMENT_ROOT"]."/bitrix/header.php");
$APPLICATION->SetTitle("123");
?>

<?if (intval($_REQUEST["trainer"])>0) { ?>
<?CModule::IncludeModule("iblock");
$res = CIBlockElement::GetByID($_REQUEST["trainer"]);
if($ar_res = $res->GetNextElement()) {
  $arResult=$ar_res->GetFields();
  $arResult["PROPERTIES"]=$ar_res->GetProperties();
}
$arSelect = Array("ID", "NAME", "DATE_ACTIVE_FROM", "PREVIEW_PICTURE", "DETAIL_PICTURE");
$arFilter = Array("IBLOCK_ID"=> 120, "PROPERTY_EXPERT"=> $arResult["ID"], "ACTIVE_DATE"=>"Y", "ACTIVE"=>"Y");
$res = CIBlockElement::GetList(Array("SORT"=>"ASC"), $arFilter, false, false, $arSelect);
while($ob = $res->GetNextElement())
{
 $arFields = $ob->GetFields();
 $cert["PREVIEW_PICTURE"]=CFile::GetFileArray($arFields["PREVIEW_PICTURE"]);
 $cert["DETAIL_PICTURE"]=CFile::GetFileArray($arFields["DETAIL_PICTURE"]);
 $cert["NAME"]=$arFields["NAME"];
 $arResult["CERT"][]=$cert;
}
$arSelect = Array("ID", "NAME", "DATE_ACTIVE_FROM", "PROPERTY_URL");
$arFilter = Array("IBLOCK_ID"=> 77, array("LOGIC"=> "OR", array("PROPERTY_URL"=> "%youtu%"), array("PROPERTY_URL"=> "%vimeo%")), "PROPERTY_EXPERT_ID"=> $arResult["ID"], "ACTIVE_DATE"=>"Y", "ACTIVE"=>"Y");
$res = CIBlockElement::GetList(Array("SORT"=>"ASC"), $arFilter, false, false, $arSelect);
while($ob = $res->GetNextElement())
{
$arVideoFields = $ob->GetFields();

if (preg_match("#youtu#", $arVideoFields["PROPERTY_URL_VALUE"])) {
		$arUrl=parse_url($arVideoFields["PROPERTY_URL_VALUE"]);
		//print_r($arUrl["query"]);
		parse_str($arUrl["query"], $output);
		$id=$output["v"];
		$video["SRC"]="http://img.youtube.com/vi/".$id."/mqdefault.jpg";
		$video["NAME"]=$arVideoFields["NAME"];
		$video["URL"]=$arVideoFields["PROPERTY_URL_VALUE"];
		$video["ID"]=$id;
		$video["LINK"]="http://www.youtube.com/embed/".$id."?autoplay=1";
		$arResult["VIDEO"][]=$video;
	}
	if (preg_match("#vimeo#", $arVideoFields["PROPERTY_URL_VALUE"])) {
		$arrSplit=preg_split("#/#", $arVideoFields["PROPERTY_URL_VALUE"]);
		$id=$arrSplit[3];
		GLOBAL $USER;
		$video["SRC"]="https://i.vimeocdn.com/video/".$id."_225x127.jpg";
		$video["NAME"]=$arVideoFields["NAME"];
		$video["URL"]=$arVideoFields["PROPERTY_URL_VALUE"];
		$video["ID"]=$id;
		$video["LINK"]="http://player.vimeo.com/video/".$id;
		$arResult["VIDEO"][]=$video;
	}
}

$arSelect = Array("ID", "NAME", "DATE_ACTIVE_FROM", "DATE_ACTIVE_FROM", "DETAIL_PAGE_URL");
$arFilter = Array("IBLOCK_ID"=> 23, "PROPERTY_expert"=> $arResult["ID"], "ACTIVE_DATE"=>"Y", "ACTIVE"=>"Y");
$res = CIBlockElement::GetList(Array("DATE_ACTIVE_FROM"=>"DESC"), $arFilter, false, false, $arSelect);
while($ob = $res->GetNextElement())
{
 $arNewsFields = $ob->GetFields();
 $arResult["NEWS"][]=$arNewsFields;
}
$expert_short = nl2br($arResult['PROPERTIES']['expert_short']['VALUE']);
$expert_name = nl2br($arResult['PROPERTIES']['expert_name']['VALUE']);
$expert_title = nl2br($arResult['PROPERTIES']['expert_title']['VALUE']);
$expert_language = nl2br($arResult['PROPERTIES']['expert_language']['VALUE']);
$expert_area = $arResult['PROPERTIES']['HTML_AREA']['~VALUE']['TEXT'];
$expert_special = $arResult['PROPERTIES']['HTML_SPECIAL']['~VALUE']['TEXT'];
$expert_experience = $arResult['PROPERTIES']['HTML_EXPERIENCE']['~VALUE']['TEXT'];
$expert_teacher =$arResult['PROPERTIES']['HTML_TEACHER']['~VALUE']['TEXT'];
$expert_edu = $arResult['PROPERTIES']['HTML_EDU']['~VALUE']['TEXT'];
$expert_certified = $arResult['PROPERTIES']['HTML_CERTIFIED']['~VALUE']['TEXT'];
$expert_publications = $arResult['PROPERTIES']['HTML_PUBLICATIONS']['~VALUE']['TEXT'];
$expert_social = $arResult['PROPERTIES']['HTML_SOCIAL']['~VALUE']['TEXT'];

if ($arResult['PROPERTIES']['HTML_AREA']['VALUE']['TYPE'] == "text" )
	$expert_area = nl2br($expert_area);
if ($arResult['PROPERTIES']['HTML_SPECIAL']['VALUE']['TYPE'] == "text" )
	$expert_special = nl2br($expert_special);
if ($arResult['PROPERTIES']['HTML_EXPERIENCE']['VALUE']['TYPE'] == "text" )
	$expert_experience = nl2br($expert_experience);
if ($arResult['PROPERTIES']['HTML_TEACHER']['VALUE']['TYPE'] == "text" )
	$expert_teacher = nl2br($expert_teacher);
if ($arResult['PROPERTIES']['HTML_EDU']['VALUE']['TYPE'] == "text" )
	$expert_edu = nl2br($expert_edu);
if ($arResult['PROPERTIES']['HTML_CERTIFIED']['VALUE']['TYPE'] == "text" )
	$expert_certified = nl2br($expert_certified);
if ($arResult['PROPERTIES']['HTML_PUBLICATIONS']['VALUE']['TYPE'] == "text" )
	$expert_publications = nl2br($expert_publications);
if ($arResult['PROPERTIES']['HTML_SOCIAL']['VALUE']['TYPE'] == "text" )
	$expert_social = nl2br($expert_social);
?>
<?function UTF($string) {
	$utf_string=iconv("windows-1251", "UTF-8", $string);
	return $utf_string;
}?>
<?$html='<style>
body {
	font-size: 13px;
	font-family: tahoma;
}
p {
	margin-bottom: 14px;
}
a {
	color: #326dab;
}
.trainer-shadow-wrap .photo{
}
.trainer-shadow-wrap h1 {
	font-size: 20px;
	margin-bottom: 10px;
	font-weight: normal;
}
.trainer-shadow-wrap .position {
	font-style: italic;
	color: #414042;
}
.trainer-shadow-wrap  .trener-header {
	width: 290px;
	float: left;
	margin-bottom: 20px;
}
.trainer-shadow-wrap  .trainer-description {
	margin-bottom: 18px;
}
.trainer-shadow-wrap  .main-knowledge {
	margin-bottom: 18px;
}
.news-trainer-wrap {
	margin-bottom: 20px;
}
.news-trainer-wrap h3{
margin-bottom: 18px;
}
.news-trainer-item {
	font-size: 14px;
	margin-bottom: 14px;
}
.trainer-news-date {
	display: inline-block;
	margin-right: 32px;
	color: #808285;
}
.footer {
				font-size:8pt; color:#a1a1a1;
				width: 100%;
			}
			.footer td {
				width: 33%;
			}
</style>';?>
<?$arResult["DETAIL_PICTURE"]=CFile::GetFileArray($arResult["DETAIL_PICTURE"]);?>
<?$html.='	
<div class="trainer-shadow-wrap">
	<table border="0" style="margin-bottom: 30px;">
	<tr>
		<td>
			<img class="photo" style="padding-right: 20px;" border="0" src="'.$arResult["DETAIL_PICTURE"]["SRC"].'" width="'.$arResult["DETAIL_PICTURE"]["WIDTH"].'" height="'.$arResult["DETAIL_PICTURE"]["HEIGHT"].'"  title="'.UTF($arResult["NAME"]).'" />
		</td>
		<td style="vertical-align: top;">
			<div class="trener-header">
				<h1 style="color: #004180;font-size: 20px; margin-bottom: 10px; font-weight: normal;"><span itemprop="name">'.UTF($arResult["NAME"]).' '.UTF($expert_name).'</span></h1>
				<div style="font-style: italic; color: #414042;" class="position"><span itemprop="role">'.UTF($expert_short).'</span></div>
			</div>
		</td>
    </tr>
	</table>

<div class="trainer-description">'.UTF($arResult['DETAIL_TEXT']).'</div><div>';?>
  <?if (strlen($expert_area)>0) {
   $html.='<div class="main-knowledge"><h3>?s?»NZN‡?µ??N‹?µ ???±?»?°N?N‚?? ?·???°??????:</h3>'.UTF($expert_area).'</div>';
  } ?>
  <?if (strlen($expert_special)>0) {
    $html.='<div class="main-knowledge"><h3>?????µN†???°?»???·?°N†????:</h3>'.UTF($expert_special).'</div>';
  }?>
  <?if (strlen($expert_experience)>0) {
    $html.='<div class="main-knowledge"><h3>?YN€??N„?µN?N????????°?»N???N‹?? ????N‹N‚:</h3>'.UTF($expert_experience).'</div>';
  } ?>

  <?if (strlen($expert_edu)>0) {
   $html.=' <div class="main-knowledge"><h3>?z?±N€?°?·?????°?????µ:</h3>'.UTF($expert_edu).'</div>';
  } ?>
  <?if (strlen($expert_publications)>0) {
    $html.='<div class="main-knowledge"><h3>?YN??±?»?????°N†????:</h3>'.UTF($expert_publications).'</div>';
  } ?>
  <?if (strlen($expert_social)>0) {
   $html.='<div class="main-knowledge"><h3>????N†???°?»N????°N? N?N„?µN€?°:</h3>'.UTF($expert_social).'</div>';
 }
$html.='</div>';?>
	<?if (is_array($arResult["CERT"])) {?>
    <?$html.='<div class="cert-wrap"><h3>???µN€N‚??N„?????°N‚N‹</h3>'?>
			<?$t=0?>
			<?foreach ($arResult["CERT"] as $key=>$arCert) {?>
				<?$html.='<div style="margin-bottom: 14px;" class="cert-item">'.UTF($arCert["NAME"]).'</div>'?>
			<?$t++?>
			<?}?>
	<?$html.='</div>'?>
	<?}?>
	<?if (is_array($arResult["VIDEO"])) {?>
    <?$html.='<div class="video-wrap"><h3>?’?????µ??</h3>'?>

					<?foreach ($arResult["VIDEO"] as $key=>$arVideo) {?>
                       <?$html.='<div style="margin-bottom: 14px;" class="cert-item-text"><a target="_blank" href="'.$arVideo["LINK"].'">'.UTF($arVideo["NAME"]).'</a></div>';?>
						<?$t++?>

					<?}?>

    <?$html.='</div>'?>


	<?} ?>
	<?//print_r($arResult["NEWS"])?>
	<?/*if (is_array($arResult["NEWS"])) {?>
    <?$html.='<div class="news-trainer-wrap"><h3>????????N?N‚??</h3>';?>
		<?foreach ( $arResult["NEWS"] as $arNews) {?>
        <?$html.='<div class="news-trainer-item"><div class="trainer-news-date">'.date('d.m.Y', strtotime($arNews["DATE_ACTIVE_FROM"])).'</div><a target="_blank" href="http://ibs-training.ru'.$arNews["DETAIL_PAGE_URL"].'">'.UTF($arNews["NAME"]).'</a></div>';?>
		<?}?>
	<?$html.='</div>'?>
    <?}*/?>
<?$html.='</div>'?>
<?include($_SERVER["DOCUMENT_ROOT"]."/bitrix/php_interface/mpdf/mpdf.php");
$mpdf=new mPDF('utf-8',"A4", "", "", 30, 30, 30, 30);
$mpdf->SetHTMLHeader('<div style="text-align: right;"><img src="/images/logo_new_pdf.jpg" alt="" title="" border="0"  /></div>');
$mpdf->SetHTMLFooter('<table class="footer"><tr><td>?Y?? ??N??µ?? ??????N€??N??°?? ???±N€?°N‰?°??N‚?µN?N? <a taget="_blank" style="color: #a1a1a1" href="mailto:<?=EMAIL_ADDRESS?>"><?=EMAIL_ADDRESS?></a></td><td style="width: 34%;text-align: center;">{PAGENO}</td><td style="text-align: right;">?’?µN€N???N? {DATE j.m.Y}</td></tr></table>');
$mpdf->WriteHTML($html);
$filename="trainer_".$arResult["CODE"].".pdf";
$mpdf->Output($_SERVER["DOCUMENT_ROOT"].'/files/'.$filename);
LocalRedirect('/files/'.$filename.'?rand='.rand('1000', '9999'));

} elseif (intval($_REQUEST["section"])>0) {
	 $ar_result=CIBlockSection::GetList(Array("LEFT_MARGIN"=> "ASC", "SORT"=>"ASC"), Array("IBLOCK_ID"=> D_TEMPCATALOG_DIRECTIONS_IBLOCK, "ID"=> intval($_REQUEST["section"]), "GLOBAL_ACTIVE"=>"Y", "ACTIVE"=>"Y"),false, Array());
    $t=0;
    if ($res=$ar_result->GetNext()){
        $arSection=$res;
        $count=CIBlockSection::GetCount(array("SECTION_ID"=>$res["ID"], "ACTIVE"=>"Y", "GLOBAL_ACTIVE"=>"Y"));
        if (intval($count)>0) {
            $arSection[$t]["IS_PARENT"]="Y";
        } else {
            $arSection[$t]["IS_PARENT"]="N";
        }
        $arSelect = Array("ID", "CODE", "NAME", "PROPERTY_PP_COURSE.NAME",  "PROPERTY_PP_COURSE.CODE", "PROPERTY_PP_COURSE.PROPERTY_COURSE_DURATION", "PROPERTY_PP_COURSE.PROPERTY_SHORT_DESCR", "DATE_ACTIVE_FROM");
        $arFilter = Array("IBLOCK_ID"=> D_TEMPCATALOG_DIRECTIONS_IBLOCK, "ACTIVE_DATE"=>"Y", "PROPERTY_PP_COURSE.ACTIVE"=>"Y", "!NAME"=>"%PTRN%", "SECTION_ID"=>$res["ID"],"ACTIVE"=>"Y");
        $res = CIBlockElement::GetList(Array("PROPERTY_PP_COURSE.CODE" => "ASC"), $arFilter, false, false, $arSelect);
        while($ob = $res->GetNextElement())
        {
           $arFields = $ob->GetFields();
           $arSection["ITEMS"][]=array("NAME"=>$arFields["PROPERTY_PP_COURSE_NAME"], "CODE"=>$arFields["PROPERTY_PP_COURSE_CODE"],"DURATION"=> $arFields["PROPERTY_PP_COURSE_PROPERTY_COURSE_DURATION_VALUE"], "DESCR"=> $arFields["PROPERTY_PP_COURSE_PROPERTY_SHORT_DESCR_VALUE"] );

        }
        $t++;
    }
	$html='
		
		<style>
		   h2 {
		   font-size: 14pt;
		   margin-top: 1pt;
		   margin-bottom: 1pt;
		   color: #3d3d3d;
		   }
		   h3 {
			font-size: 14pt;
			font-weight: bold;
		   }
		   h4 {
			font-size: 12pt;
			font-weight: bold;
		   }
		   body {
			font-family: Arial;
		   }
			div.mpdf_toc {
			   line-height: 16px;
			   font-family: Arial;
			}
			a.mpdf_toc_a  {
			 font-size: 9pt;
			 color: black !important;
			 text-decoration: none;
			}
			div.mpdf_toc_level_1 {		
			margin-left: 1em;
			text-indent: -2em;
				
			}
			.main-table {
				width: 100%;
				border-collapse: collapse;
			}
			.main-table table td{
			border: none;
			padding: 0;
			margin: 0;
			}
			.main-table table td.descr{
			border: none;
			padding: 5px;
			}
			.main-table .head td{
				color: #3d3d3d;
				padding: 5px;
				border-top: none;
				font-size: 12px;
			}
			.main-table td.duration{
				text-align: center;
			}
			.main-table td {
				font-size: 12px;
				padding: 10px;
				border-bottom: 1px solid #000000;
			}
			.footer {
				font-size:8pt; color:#a1a1a1;
				width: 100%;
			}
			.footer td {
				width: 33%;
			}
		</style>
		<setpagefooter name="myFooter1"/>
';
	include($_SERVER["DOCUMENT_ROOT"]."/bitrix/php_interface/mpdf/mpdf.php");
	$mpdf=new mPDF('utf-8',"A4-L", "", "", 30, 30, 20);
	$mpdf->SetHTMLHeader('<div style="text-align: right;"><img src="/images/logo_new_pdf.jpg" alt="" title="" border="0"  /></div>');
	$mpdf->SetHTMLFooter('<table class="footer"><tr><td>?Y?? ??N??µ?? ??????N€??N??°?? ???±N€?°N‰?°??N‚?µN?N? <a style="color: #a1a1a1" href="mailto:<?=EMAIL_ADDRESS?>"><?=EMAIL_ADDRESS?></a></td><td style="width: 34%;text-align: center;">{PAGENO}</td><td style="text-align: right;">?’?µN€N???N? {DATE j.m.Y}</td></tr></table>');
	$mpdf->WriteHTML($html);
	$mpdf->h2toc = array('H3'=>0);
	$mpdf->h2bookmarks = array('H3'=>0);
	$section=$arSection;

		if ($section["DEPTH_LEVEL"]==1) {
			$mpdf->WriteHTML('<h3>'.iconv("windows-1251", "UTF-8", $section["NAME"]).'</h3>',2);
		} elseif ($section["DEPTH_LEVEL"]==2) {
			/*if ($section["ID"]==541) {
				 $mpdf->AddPage();
			}	*/
			if (count($section["ITEMS"])>0) {
			$mpdf->WriteHTML('<h4>'.iconv("windows-1251", "UTF-8",$section["NAME"]).'</h4>',2);
			}
		}

    if (count($section["ITEMS"])>0) {
        $courses='<table cellspacing="0" cellpadding="0" class="main-table"><tr class="head"><td>?s????</td><td>???°?·???°?????µ ??N?N€N??°, ??N€?°N‚?????µ N??????µN€?¶?°?????µ</td><td style="width: 80px">?”?»??N‚., N‡.</td></tr>';
        foreach ($section["ITEMS"] as $item) {
            $courses.='<tr><td>'.$item["CODE"].'</td><td><table><tr><td><b>'.iconv("windows-1251", "UTF-8", $item["NAME"]).'</b></td></tr><tr><td class="descr">'.iconv("windows-1251", "UTF-8", $item["DESCR"]).'</td></tr></table></td><td class="duration">'.$item["DURATION"].'</td></tr>';
        }
        $courses.='</table>';
        $mpdf->WriteHTML($courses);
    }

		if ($section["IS_PARENT"]=="N" && is_array($arSection[$key+1])) {
			if (count($section["ITEMS"])>0) {
				$mpdf->AddPage();
			}
		}
	$info='	<h4>?z?± N?N‡?µ?±?????? N†?µ??N‚N€?µ Luxoft Training</h4>
			<p><b>Luxoft Training</b> a€“ ?»?????µN€ ?? ???±?»?°N?N‚?? ???±N?N‡?µ????N? ?? ??????N??°?»N‚???????° ???? ???°?¶???µ??N????? ????N?N†?????»?????°?? Software Engineering. ??N‡?µ?±??N‹?? N†?µ??N‚N€ N?N?N‰?µN?N‚??N??µN‚ N? 2007 ??. ?? ??N€?µ???»?°???°?µN‚ ?±???»?µ?µ 150 ??N?N€N?????, N‚N€?µ???????????? ?? N?N‡?µ?±??N‹N… ??N€????N€?°????. ?z?±N?N‡?µ?????µ ??N€????????N?N‚ ?±???»?µ?µ 120 ??N€??N„?µN?N????????°?»N???N‹N… N‚N€?µ???µN€???? a€“ N???N????µN€N‚????-??N€?°??N‚????????. 
			?—?° N?N‚?? ??N€?µ??N? ?? Luxoft Training ??N€??N??»?? ???±N?N‡?µ?????µ N???N‚N€N??????????? ???µ??N?N‰??N… N€??N?N?????N?????N… ?? ???µ?¶??N????°N€??????N‹N… ?????????°??????. ?­N„N„?µ??N‚????????N?N‚N? ???±N?N‡?µ????N? ??????N‚???µN€?¶???°?µN‚N?N? ??????????N‡??N??»?µ????N‹???? ?????»???¶??N‚?µ?»N???N‹???? ??N‚?·N‹???°???? ???°N???N… ???»???µ??N‚????:</p>
			<p><b>? ???™?¤?¤???™?—?•?? ?‘?????s ???’???›?¬</b>: A«???µ??????????N€?°N‚??N‹?µ N‚N€?µ??????????, ????N‚??N€N‹?µ ??N€???????????»??N?N? N???N????µN€N‚?°???? ??N‡?µ?±???????? N†?µ??N‚N€?° ???»N? N???N‚N€N????????????? ?‘?°?????° ?? N€?°?·N€?µ?·?µ ????N„??N€???°N†????????N‹N… N‚?µN…?????»????????, ?? N‡?°N?N‚????N?N‚?? ?±???·???µN?-?°???°?»??N‚?????? ?? N‚?µN?N‚??N€?????°????N?, ??????N‹N????»?? ?????°?»??N„?????°N†??NZ N?N‡?°N?N‚?????????? ???±N?N‡?µ????N?, ???°?»?? ?±???»?µ?µ ???»N??±???????µ ??N€?µ??N?N‚?°???»?µ?????µ ?? N€?°N?N????°N‚N€?????°?µ??N‹N… N‚?µ???°N…, ?????·?????»???»?? N???N?N‚?µ???°N‚???·??N€?????°N‚N? N??¶?µ ?????µNZN‰???µN?N? ?·???°????N? ?? ???°??N‚?? ??N?N‚?? ??N€?°??N‚??N‡?µN????????? ??N… ??N€?????µ???µ????N?A».</p>
			<p><b>???z? ?”?•?? ?‘?????s</b>: A«?­??N????µN€N‚ ???? N???N€?°???»?µ????NZ ?? ????????N????????°N†??N????? ???¦ Luxoft ?”????N‚N€???? ?‘?°N??°?????? ???° ??N€??N‚N??¶?µ?????? ??N??µ???? N‚N€?µ?????????° N????µN€?¶?????°?» ?????????°?????µ ?°N?????N‚??N€???? ?±?»?°???????°N€N? ????N‚?µN€?µN???????N? ?????°?»????N?, ??N€?????µN€?°?? ???· ??N€?°??N‚?????? ?? ?»?µ???????? ???????°N‡?µ ???°N‚?µN€???°?»?°...  ?’N‹N€?°?¶?°?µ?? ?±?»?°???????°N€????N?N‚N? ?·?° N…??N€??N?N?NZ ??N€???°?????·?°N†??NZ ???±N?N‡?µ????N?, ??N‹N????????? ??N€??N„?µN?N????????°?»???·?? N???N????µN€N‚???? ?? ???°N‡?µN?N‚???µ?????? N€?°?·N€?°?±??N‚?°????N‹?µ ??N?N€N?N‹. ???°???µ?µ??N?N? ???° ???°?»N????µ??N??µ?µ N???N‚N€N???????N‡?µN?N‚???? N? ??N‡?µ?±??N‹?? ?¦?µ??N‚N€???? LuxoftA».</p>
			<p><b>?›???‘?z? ?????z? ???? ?s?????Y?•? ???s?z?“?z</b>: A«?’???µN‡?°N‚?»?µ????N? ??N‚ N‚N€?µ?????????° ??N????»NZN‡??N‚?µ?»N????? ?????»???¶??N‚?µ?»N???N‹?µ. ??N€?µ???µN€ ???????°????N‡???? ?? ????N‚?µN€?µN????? ???????°???°?» ???°N‚?µN€???°?», ?±N‹?»?? ????N‚?µN€?µN????? N??»N?N??°N‚N? ?? ?·?°???????°N‚N?N?N? ??N€?°??N‚??N‡?µN????????? ?·?°???°????N?????. ?Y??N??»?µ N‚N€?µ?????????° ?? ?????»?????µ ??N?N‚?°?µN‚N?N? ?????????? ?????»?µ?·?????? ?? N…??N€??N??? N?N‚N€N???N‚N?N€??N€?????°???????? ????N„??N€???°N†????A».</p>
			<p>?z?±N?N‡?µ?????µ ??N€??N…??????N‚ ?? ??N‚??N€N‹N‚????, ????N€????N€?°N‚?????????? ?? ?????»?°????-N„??N€???°N‚?µ. ?¦?µ??N‚N€N‹ ???±N?N‡?µ????N? N€?°N??????»???¶?µ??N‹ ?? ????N??????µ, ???°????N‚-?Y?µN‚?µN€?±N?N€???µ, ?z??N????µ, ?s???µ???µ, ?z???µN?N??µ, ?”???µ??N€?????µN‚N€????N????µ.<br/>?z?±N?N‡?µ?????µ ?????¶?µN‚ ?±N‹N‚N? ??N€???°?????·?????°???? ???° N‚?µN€N€??N‚??N€???? ?·?°???°?·N‡?????°, N? N?N‡?µN‚???? N‚N€?µ?±?????°?????? ??N€?????·??????N?N‚???µ?????????? ??N€??N†?µN?N??°.</p>
		';
	$mpdf->AddPage();
	$mpdf->WriteHTML($info);
	$filename="catalog_".$section["CODE"].".pdf";
	$mpdf->Output($_SERVER["DOCUMENT_ROOT"].'/files/'.$filename);
	LocalRedirect('/files/'.$filename.'?rand='.rand('1000', '9999'));

} else {
if(CModule::IncludeModule("iblock"))
{
    $ar_result=CIBlockSection::GetList(Array("LEFT_MARGIN"=> "ASC", "SORT"=>"ASC"), Array("IBLOCK_ID"=> D_TEMPCATALOG_DIRECTIONS_IBLOCK, "GLOBAL_ACTIVE"=>"Y", "ACTIVE"=>"Y"),false, Array());
    $t=0;
    while ($res=$ar_result->GetNext()){
        $arSection[$t]=$res;
        $count=CIBlockSection::GetCount(array("SECTION_ID"=>$res["ID"], "ACTIVE"=>"Y", "GLOBAL_ACTIVE"=>"Y"));
        if (intval($count)>0) {
            $arSection[$t]["IS_PARENT"]="Y";
        } else {
            $arSection[$t]["IS_PARENT"]="N";
        }
        $arSelect = Array("ID", "CODE", "NAME", "PROPERTY_PP_COURSE.NAME",  "PROPERTY_PP_COURSE.CODE", "PROPERTY_PP_COURSE.PROPERTY_COURSE_DURATION", "PROPERTY_PP_COURSE.PROPERTY_SHORT_DESCR", "DATE_ACTIVE_FROM");
        $arFilter = Array("IBLOCK_ID"=> D_TEMPCATALOG_DIRECTIONS_IBLOCK, "ACTIVE_DATE"=>"Y", "PROPERTY_PP_COURSE.ACTIVE"=>"Y", "!NAME"=>"%PTRN%", "SECTION_ID"=>$res["ID"],"ACTIVE"=>"Y");
        $res = CIBlockElement::GetList(Array("PROPERTY_PP_COURSE.CODE" => "ASC"), $arFilter, false, false, $arSelect);
        while($ob = $res->GetNextElement())
        {
           $arFields = $ob->GetFields();
           $arSection[$t]["ITEMS"][]=array("NAME"=>$arFields["PROPERTY_PP_COURSE_NAME"], "CODE"=>$arFields["PROPERTY_PP_COURSE_CODE"],"DURATION"=> $arFields["PROPERTY_PP_COURSE_PROPERTY_COURSE_DURATION_VALUE"], "DESCR"=> $arFields["PROPERTY_PP_COURSE_PROPERTY_SHORT_DESCR_VALUE"] );

        }
        $t++;
    }

}?>
<form target="_blank">
<select name="section">
<?foreach ($arSection as $arSec) {?>
	<?if (count($arSec["ITEMS"])>0) {?>
	<option value="<?=$arSec["ID"]?>"><?=$arSec["NAME"]?></option>
	<?}?>
<?}?>
</select>
<input name="download" value="Download" type="submit">

</form>
<?if(CModule::IncludeModule("iblock"))
{
    $arSelect = Array("ID", "CODE", "NAME", "PROPERTY_expert_name" );
    $arFilter = Array("IBLOCK_ID"=> D_EXPERT_ID_IBLOCK, "ACTIVE_DATE"=>"Y", "ACTIVE"=>"Y");
	$res = CIBlockElement::GetList(Array("NAME" => "ASC"), $arFilter, false, false, $arSelect);
        while($ob = $res->GetNextElement())
        {
           $arFields = $ob->GetFields();
		   $arTrainer[]=$arFields;
        }


}?>
<form target="_blank">
<select name="trainer">
<?foreach ($arTrainer as $arTr) {?>

	<option value="<?=$arTr["ID"]?>"><?=$arTr["NAME"]?> <?=$arTr["PROPERTY_EXPERT_NAME_VALUE"]?></option>

<?}?>
</select>
<input name="download" value="Download" type="submit">
</form>
<?}?>
<?require($_SERVER["DOCUMENT_ROOT"]."/bitrix/footer.php");?>
